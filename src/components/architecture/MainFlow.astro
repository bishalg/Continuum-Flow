---
// Main Architecture Flowchart - Responsive Design
---

<div class="main-flow-container my-8 not-prose">
  <div
    class="bg-white dark:bg-slate-900 rounded-2xl shadow-xl border border-slate-200 dark:border-white/10 overflow-hidden"
  >
    <div class="p-4 sm:p-6 md:p-8 lg:p-12">
      <div class="flex flex-col gap-4 sm:gap-6 md:gap-8">
        <!-- LAYER 1: INPUT -->
        <div class="flex justify-center">
          <div
            class="node-box bg-slate-800 text-white p-4 sm:p-5 md:p-6 rounded-xl w-full sm:w-64 text-center shadow-lg border-l-4 border-sky-500 print-light-card"
          >
            <div class="text-xs text-sky-400 font-bold tracking-wider mb-1">
              SOURCE
            </div>
            <div class="text-lg sm:text-xl font-bold">Markdown Novel</div>
            <div class="text-xs text-slate-400 mt-2 font-mono">
              *.md (Chapter Files)
            </div>
          </div>
        </div>

        <!-- CONNECTOR -->
        <div class="flex flex-col items-center h-8 sm:h-12">
          <div class="connector-v animate-pulse-slow"></div>
          <div class="arrow-down animate-bounce-subtle"></div>
        </div>

        <!-- LAYER 2: PROCESSING (Parallel) - Stacks on mobile, side-by-side on tablet+ -->
        <div
          class="flex flex-col sm:flex-row gap-4 sm:gap-6 md:gap-8 justify-center"
        >
          <!-- Left: Static Assets -->
          <div class="flex flex-col items-center flex-1 sm:max-w-xs">
            <div
              class="node-box bg-white dark:bg-slate-800 border-2 border-slate-200 dark:border-white/10 p-4 sm:p-5 rounded-lg w-full shadow-sm"
            >
              <div class="flex items-center gap-3 mb-3">
                <div
                  class="bg-amber-50 dark:bg-amber-900/40 text-amber-500 dark:text-amber-400 p-2 rounded-lg font-bold text-sm"
                >
                  A
                </div>
                <div
                  class="font-bold text-slate-700 dark:text-slate-200 text-sm sm:text-base"
                >
                  Asset Definition
                </div>
              </div>
              <ul
                class="text-xs sm:text-sm text-slate-500 dark:text-slate-400 space-y-1"
              >
                <li class="flex items-center gap-2">
                  <span
                    class="w-1.5 h-1.5 bg-amber-400 rounded-full flex-shrink-0"
                  ></span>
                  <span>Character Profiles</span>
                </li>
                <li class="flex items-center gap-2">
                  <span
                    class="w-1.5 h-1.5 bg-amber-400 rounded-full flex-shrink-0"
                  ></span>
                  <span>Visual Style Guides</span>
                </li>
              </ul>
            </div>
            <div
              class="connector-v h-8 sm:h-16 w-0.5 bg-slate-200 dark:bg-white/10 my-2 animate-pulse-slow"
            >
            </div>
          </div>

          <!-- Right: Dynamic Context -->
          <div class="flex flex-col items-center flex-1 sm:max-w-xs">
            <div
              class="node-box bg-white dark:bg-slate-800 border-2 border-slate-200 dark:border-white/10 p-4 sm:p-5 rounded-lg w-full shadow-sm"
            >
              <div class="flex items-center gap-3 mb-3">
                <div
                  class="bg-sky-50 dark:bg-sky-900/40 text-sky-500 dark:text-sky-400 p-2 rounded-lg font-bold text-sm"
                >
                  B
                </div>
                <div
                  class="font-bold text-slate-700 dark:text-slate-200 text-sm sm:text-base"
                >
                  Context "Continuum Flow"
                </div>
              </div>
              <ul
                class="text-xs sm:text-sm text-slate-500 dark:text-slate-400 space-y-1"
              >
                <li class="flex items-center gap-2">
                  <span
                    class="w-1.5 h-1.5 bg-sky-400 rounded-full flex-shrink-0"
                  ></span>
                  <span>Chapter Summaries</span>
                </li>
                <li class="flex items-center gap-2">
                  <span
                    class="w-1.5 h-1.5 bg-sky-400 rounded-full flex-shrink-0"
                  ></span>
                  <span>Hierarchical Backbone</span>
                </li>
              </ul>
            </div>
            <div
              class="connector-v h-8 sm:h-16 w-0.5 bg-slate-200 dark:bg-white/10 my-2 animate-pulse-slow"
            >
            </div>
          </div>
        </div>

        <!-- LAYER 3: THE CORE (Prompt Construction) -->
        <div
          class="bg-slate-50/80 dark:bg-white/5 rounded-xl border-2 border-dashed border-slate-200 dark:border-white/10 p-4 sm:p-6 relative"
        >
          <div
            class="absolute -top-3 left-4 sm:left-8 bg-slate-50 dark:bg-slate-800 px-2 text-[10px] sm:text-xs font-bold text-slate-400 uppercase"
          >
            Phase 3
          </div>

          <div class="flex flex-col gap-4">
            <!-- Context Labels - hidden on mobile, shown on larger screens -->
            <div class="hidden md:flex justify-between text-xs font-bold px-2">
              <div class="text-amber-500 dark:text-amber-400">
                STATIC CONTEXT
              </div>
              <div class="text-sky-500 dark:text-sky-400">DYNAMIC CONTEXT</div>
            </div>

            <div
              class="node-box bg-gradient-to-br from-teal-500 to-sky-600 text-white p-4 sm:p-6 rounded-xl shadow-xl w-full"
            >
              <div
                class="text-base sm:text-lg font-bold mb-3 sm:mb-4 flex items-center gap-2"
              >
                <span class="text-xl sm:text-2xl">⚙️</span>
                <span class="leading-tight">Prompt Construction Engine</span>
              </div>
              <div
                class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-4 text-center"
              >
                <div
                  class="bg-white/10 p-2 sm:p-3 rounded backdrop-blur-sm border border-white/10"
                >
                  <div class="text-[10px] sm:text-xs opacity-70 uppercase mb-1">
                    Retrieval
                  </div>
                  <div class="font-bold text-xs sm:text-sm">
                    Fetch Scene Chunk
                  </div>
                </div>
                <div
                  class="bg-white/10 p-2 sm:p-3 rounded backdrop-blur-sm border border-white/10"
                >
                  <div class="text-[10px] sm:text-xs opacity-70 uppercase mb-1">
                    Inject
                  </div>
                  <div class="font-bold text-xs sm:text-sm">
                    Character/Visual Defs
                  </div>
                </div>
                <div
                  class="bg-white/10 p-2 sm:p-3 rounded backdrop-blur-sm border border-white/10"
                >
                  <div class="text-[10px] sm:text-xs opacity-70 uppercase mb-1">
                    Synthesize
                  </div>
                  <div class="font-bold text-xs sm:text-sm">
                    Final Video Prompt
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- CONNECTOR -->
        <div class="flex flex-col items-center h-6 sm:h-8">
          <div class="connector-v animate-pulse-slow"></div>
          <div class="arrow-down animate-bounce-subtle"></div>
        </div>

        <!-- LAYER 4: OUTPUT PIPELINE -->
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4">
          <div
            class="node-box bg-white dark:bg-slate-800 border-l-4 border-indigo-400 p-3 sm:p-4 shadow rounded-r-lg"
          >
            <div
              class="font-bold text-indigo-600 dark:text-indigo-400 text-xs sm:text-sm"
            >
              1. Scene Description
            </div>
            <div
              class="text-[10px] sm:text-xs text-slate-400 dark:text-slate-400 mt-1"
            >
              Lighting, Mood, Action
            </div>
          </div>
          <div
            class="node-box bg-white dark:bg-slate-800 border-l-4 border-purple-400 p-3 sm:p-4 shadow rounded-r-lg"
          >
            <div
              class="font-bold text-purple-600 dark:text-purple-400 text-xs sm:text-sm"
            >
              2. Camera Directives
            </div>
            <div
              class="text-[10px] sm:text-xs text-slate-400 dark:text-slate-400 mt-1"
            >
              Angle, Motion, Zoom
            </div>
          </div>
          <div
            class="node-box bg-white dark:bg-slate-800 border-l-4 border-pink-400 p-3 sm:p-4 shadow rounded-r-lg"
          >
            <div
              class="font-bold text-pink-600 dark:text-pink-400 text-xs sm:text-sm"
            >
              3. Video Generation
            </div>
            <div
              class="text-[10px] sm:text-xs text-slate-400 dark:text-slate-400 mt-1"
            >
              10s Segment Render
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .node-box {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
  }

  @media (hover: hover) {
    .node-box:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
      z-index: 10;
    }
  }

  .connector-v {
    width: 2px;
    background-color: #e2e8f0;
    margin: 0 auto;
    flex-grow: 1;
    min-height: 16px;
  }

  :global(.dark) .connector-v {
    background-color: rgba(255, 255, 255, 0.1);
  }

  .arrow-down::after {
    content: "▼";
    font-size: 10px;
    color: #94a3b8;
    display: block;
    text-align: center;
    margin-top: -6px;
  }

  @media (min-width: 640px) {
    .arrow-down::after {
      font-size: 12px;
      margin-top: -8px;
    }
  }

  @keyframes pulse-slow {
    0%,
    100% {
      opacity: 0.6;
    }
    50% {
      opacity: 1;
    }
  }

  .animate-pulse-slow {
    animation: pulse-slow 3s ease-in-out infinite;
  }

  @keyframes bounce-subtle {
    0%,
    100% {
      transform: translateY(0);
      opacity: 0.8;
    }
    50% {
      transform: translateY(3px);
      opacity: 1;
    }
  }

  .animate-bounce-subtle {
    animation: bounce-subtle 2s ease-in-out infinite;
  }

  /* Print-specific styles for A4 PDF */
  @media print {
    .main-flow-container {
      page-break-inside: avoid;
      break-inside: avoid;
      margin: 16px auto !important; /* Centered margin */
      display: flex;
      justify-content: center;
      width: 100% !important;
      transform: scale(0.95); /* Prevent clipping */
      transform-origin: center top;
    }

    .main-flow-container > div {
      background: white !important;
      border: 1px solid #e5e7eb !important;
      box-shadow: none !important;
      max-width: 100%;
    }

    .node-box {
      transform: none !important;
      box-shadow: none !important;
    }

    /* Force "Markdown Novel" card to be light in print */
    .print-light-card {
      background-color: white !important;
      border: 2px solid #e2e8f0 !important;
      color: #0f172a !important; /* Slate-900 */
    }

    .print-light-card .text-white {
      color: #0f172a !important;
    }

    /* Ensure dark backgrounds are visible in print */
    .bg-slate-800:not(.print-light-card) {
      background-color: #1e293b !important;
      -webkit-print-color-adjust: exact !important;
      print-color-adjust: exact !important;
    }

    /* Gradient backgrounds for print */
    .bg-gradient-to-br {
      -webkit-print-color-adjust: exact !important;
      print-color-adjust: exact !important;
    }

    /* Hide animations in print */
    .animate-pulse-slow,
    .animate-bounce-subtle {
      animation: none !important;
    }

    /* Connectors visible in print */
    .connector-v {
      background-color: #94a3b8 !important;
    }
  }
</style>
